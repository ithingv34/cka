(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{362:function(t,s,a){t.exports=a.p+"assets/img/1-10.769a1f85.png"},379:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"클러스터-버전-업그레이드"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#클러스터-버전-업그레이드"}},[t._v("#")]),t._v(" 클러스터 버전 업그레이드")]),t._v(" "),n("p",[t._v("기존 클러스터의 버그 수정 및 새로운 기능 추가를 위하여 클러스터 버전을 업그레이드 할 수 있다.")]),t._v(" "),n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[n("strong",[t._v("업그레이드는")]),t._v(" 현재 실행 중인 워크로드의 중단을 피하고 클러스터 노드의 손상을 막기 위해 통제된 방식으로 수행되어야 한다.")])]),t._v(" "),n("p",[n("strong",[t._v("업그레이드 과정")])]),t._v(" "),n("img",{attrs:{src:a(362)}}),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[t._v("고가용성을 위해 여러 개의 클러스터를 사용하는 경우 한 번에 하나씩 Control Plane 노드를 업그레이드 해야 한다.")])]),t._v(" "),n("hr"),t._v(" "),n("p",[n("strong",[t._v("Master 노드 업그레이드")])]),t._v(" "),n("ol",[n("li",[t._v("먼저 Control Plane 노드에 "),n("code",[t._v("ssh")]),t._v("로 접속해야한다.\n"),n("ul",[n("li",[t._v("여러개의 Control Plane 중에서 "),n("code",[t._v("kubeconfig")]),t._v(" 파일 ("),n("code",[t._v("/etc/kubernetes/admin.conf")]),t._v(")을 가지고 있는 Control Plane을 선택한다.")])])])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" kube-control-plane\nWelcome to Ubuntu "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18.04")]),t._v(".5 LTS "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GNU/Linux "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.15")]),t._v(".0-132-generic x86_64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("쿠버네티스 버전을 확인한다.\n"),n("ul",[n("li",[t._v("현재 버전은 1.18.0")]),t._v(" "),n("li",[t._v("이번 예제에서는 단일 클러스터, 단일 워커 노드로 업그레이드를 진행한다.")])])])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl get nodes\nNAME                 STATUS   ROLES    AGE     VERSION\nkube-control-plane   Ready    master   4m54s   v1.18.0\nkube-worker-1        Ready    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   3m18s   v1.18.0\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[n("code",[t._v("kubeadm")]),t._v(" 버전을 업그레이드\n"),n("ul",[n("li",[t._v("target 버전은 1.19.0-00")])])])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# 설치 가능한 패키지 리스트를 최신화\n$ sudo apt update\n# 업그레이드할 버전을 확인\n$ sudo apt-cache madison kubeadm\n    kubeadm |  1.21.2-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.21.1-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.21.0-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.8-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.7-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.6-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.5-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.4-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.2-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.1-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n   kubeadm |  1.20.0-00 | http://apt.kubernetes.io kubernetes-xenial/main \\\n   amd64 Packages\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[n("code",[t._v("kubeadm")]),t._v("을 1.19.0-00 버전으로 업그레이드")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark unhold kubeadm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -y "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubeadm")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark hold kubeadm\n\nCanceled hold on kubeadm.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nUnpacking kubeadm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" over "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.18")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSetting up kubeadm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nkubeadm "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" on hold.\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y --allow-change-held-packages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubeadm")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nkubeadm is already the newest version "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" upgraded, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" newly installed, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" to remove and "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" not upgraded.\n$ kubeadm version\nkubeadm version: "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("version.Info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Major:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(", Minor:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19"')]),t._v(", GitVersion:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.19.0"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nGitCommit:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"e19964183377d0ec2052d1f1fa930c4d7575bd50"')]),t._v(", GitTreeState:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clean"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nBuildDate:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-12-27T14:28:32Z"')]),t._v(", GoVersion:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go1.15"')]),t._v(", Compiler:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gc"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nPlatform:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"linux/amd64"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[t._v("현재 클러스터를 업그레이드 할 수 있는지 버전을 확인한다.\n"),n("ul",[n("li",[t._v("현재 버전: 1.18.20")]),t._v(" "),n("li",[t._v("kubeadm 버전: 1.19.0")]),t._v(" "),n("li",[t._v("1.19.12로 업그레이드가 가능하다.")])])])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm upgrade plan\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Fetching available versions to upgrade to\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Cluster version: v1.18.20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" kubeadm version: v1.19.0\nI0708 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":32:53.037895   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17430")]),t._v(" version.go:252"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" remote version is much newer: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nv1.21.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" falling back to: stable-1.19\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Latest stable version: v1.19.12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Latest version "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the v1.18 series: v1.18.20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nYou can now apply the upgrade by executing the following command:\n\n\tkubeadm upgrade apply v1.19.12\n\nNote: Before you can perform this upgrade, you have to update kubeadm to v1.19.12.\n")])])]),n("ol",{attrs:{start:"6"}},[n("li",[t._v("1.19.0으로 업그레이드 적용\n"),n("ul",[n("li",[t._v("시간이 몇 분 걸릴 수 있다.")]),t._v(" "),n("li",[t._v("CNI 플러그인도 업그레이드가 필요할 수 있다.")])])])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm upgrade apply v1.19.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" You have chosen to change the cluster version to "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.19.0"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Cluster version: v1.18.20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" kubeadm version: v1.19.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/successful"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" SUCCESS"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Your cluster was upgraded to "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.19.0"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Enjoy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/kubelet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Now that your control plane is upgraded, please proceed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nwith upgrading your kubelets "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" you haven't already "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v(" so.\n\n")])])]),n("ol",{attrs:{start:"7"}},[n("li",[t._v("ControlPlane 노드를 "),n("code",[t._v("Drain")]),t._v("해서 워크로드를 제거한다. "),n("code",[t._v("uncordoned")]),t._v(" 될 때 까지 워크로드가 스케줄링 되지 않는다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl drain kube-control-plane --ignore-daemonsets\nnode/kube-control-plane cordoned\nWARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-qndb9, "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nkube-system/kube-proxy-vpvms\nevicting pod kube-system/calico-kube-controllers-65f8bc95db-krp72\nevicting pod kube-system/coredns-f9fd979d6-2brkq\npod/calico-kube-controllers-65f8bc95db-krp72 evicted\npod/coredns-f9fd979d6-2brkq evicted\nnode/kube-control-plane evicted\n")])])]),n("ol",{attrs:{start:"8"}},[n("li",[t._v("kubelet과 kubectl을 동일한 버전으로 업그레이드")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark unhold kubelet kubectl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubelet")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubectl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  hold kubelet kubectl\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSetting up kubelet "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSetting up kubectl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nkubelet "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" on hold.\nkubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" on hold.\n")])])]),n("ol",{attrs:{start:"9"}},[n("li",[t._v("kubelet 프로세스를 재시작")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl daemon-reload\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart kubelet\n")])])]),n("ol",{attrs:{start:"10"}},[n("li",[t._v("Drain 됐던 control plane을 uncordon 한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl uncordon kube-control-plane\nnode/kube-control-plane uncordoned\n")])])]),n("ol",{attrs:{start:"11"}},[n("li",[t._v("Control Plane 노드 버전 확인")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ kubectl get nodes\nNAME                 STATUS   ROLES    AGE   VERSION\nkube-control-plane   Ready    master   21h   v1.19.0\nkube-worker-1        Ready    <none>   21h   v1.18.0\n")])])]),n("ol",{attrs:{start:"12"}},[n("li",[t._v("로그아웃")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ exit\nlogout\n")])])]),n("hr"),t._v(" "),n("p",[n("strong",[t._v("Worker 노드 업그레이드")])]),t._v(" "),n("ol",[n("li",[t._v("Worker 노드 중 하나를 선택하고 ssh로 접속한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" kube-worker-1\nWelcome to Ubuntu "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18.04")]),t._v(".5 LTS "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GNU/Linux "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.15")]),t._v(".0-132-generic x86_64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("code",[t._v("kubeadm")]),t._v(" target 버전으로 업그레이드 한다.\n"),n("ul",[n("li",[t._v("master node에서 했던 것과 동일한 명령이다.")])])])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('$ sudo apt-mark unhold kubeadm && sudo apt-get update && sudo apt-get install \\\n  -y kubeadm=1.19.0-00 && sudo apt-mark hold kubeadm\n\nCanceled hold on kubeadm.\n...\nUnpacking kubeadm (1.19.0-00) over (1.18.0-00) ...\nSetting up kubeadm (1.19.0-00) ...\nkubeadm set on hold.\n$ kubeadm version\nkubeadm version: &version.Info{Major:"1", Minor:"19", GitVersion:"v1.19.0", \\\nGitCommit:"e19964183377d0ec2052d1f1fa930c4d7575bd50", GitTreeState:"clean", \\\nBuildDate:"2022-12-27T14:28:32Z", GoVersion:"go1.15", Compiler:"gc", \\\nPlatform:"linux/amd64"}\n')])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("kubelet configuration을 업그레이드한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm upgrade "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system \\\nget cm kubeadm-config -o yaml'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Skipping prepull. Not a control plane node.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Skipping phase. Not a control plane node.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" The configuration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" was successfully updated"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Now you should go ahead and upgrade the kubelet package using your "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\npackage manager.\n\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[t._v("업그레이드할 노드를 drain한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl drain kube-worker-1 --ignore-daemonsets\n\nnode/kube-worker-1 cordoned\nWARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-2hrxg, "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nkube-system/kube-proxy-qf6nl\nevicting pod kube-system/calico-kube-controllers-65f8bc95db-kggbr\nevicting pod kube-system/coredns-f9fd979d6-7zm4q\nevicting pod kube-system/coredns-f9fd979d6-tlmhq\npod/calico-kube-controllers-65f8bc95db-kggbr evicted\npod/coredns-f9fd979d6-7zm4q evicted\npod/coredns-f9fd979d6-tlmhq evicted\nnode/kube-worker-1 evicted\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[t._v("kubelet과 kubectl을 업그레이드한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark unhold kubelet kubectl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubelet")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kubectl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-mark hold kubelet "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nkubectl\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSetting up kubelet "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSetting up kubectl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v(".0-00"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nkubelet "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" on hold.\nkubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" on hold.\n")])])]),n("ol",{attrs:{start:"6"}},[n("li",[t._v("kubelet 프로세스를 재시작한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl daemon-reload\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart kubelet\n")])])]),n("ol",{attrs:{start:"7"}},[n("li",[t._v("노드를 uncordon한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl uncordon kube-worker-1\nnode/kube-worker-1 uncordoned\n")])])]),n("ol",{attrs:{start:"8"}},[n("li",[t._v("새로운 버전인 1.19.0가 노드에도 적용됐는지 확인한다.")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ kubectl get nodes\nNAME                 STATUS   ROLES    AGE   VERSION\nkube-control-plane   Ready    master   24h   v1.19.0\nkube-worker-1        Ready    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   24h   v1.19.0\n")])])]),n("ol",{attrs:{start:"9"}},[n("li",[t._v("로그아웃")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("logout")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);