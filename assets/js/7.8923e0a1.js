(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{359:function(t,e,s){t.exports=s.p+"assets/img/1-5.e73a117c.png"},360:function(t,e,s){t.exports=s.p+"assets/img/1-6.0b85d981.png"},377:function(t,e,s){"use strict";s.r(e);var a=s(44),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"역할-기반-액세스-제어-rbac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#역할-기반-액세스-제어-rbac"}},[t._v("#")]),t._v(" 역할 기반 액세스 제어 (RBAC)")]),t._v(" "),a("h2",{attrs:{id:"rbac-이란"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rbac-이란"}},[t._v("#")]),t._v(" RBAC 이란?")]),t._v(" "),a("p",[a("strong",[t._v("권한 관리")])]),t._v(" "),a("p",[t._v("쿠버네티스에서는 Pod, Namespace 등의 API 리소스에 대한 요청을 허용하기 전에 인증을 받아야 한다. 우리가 인터넷 쇼핑몰에서 주문을 하기 위해서는 회원가입을 하고 로그인을 해야 하는 것과 마찬가지로 쿠버네티스 관리자는 사용자, 그룹등을 생성하고 그들에게 리소스를 읽고 쓸 수 있는 권한을 부여할 수 있다.")]),t._v(" "),a("p",[t._v("쿠버네티스 관리자는 전체 액세스 권한을 가지고 특정 사용자에게는 역할에 따라 읽기 권한만 부여할 수 있다. 예를들어 애플리케이션 개발자는 클러스터 노드를 관리할 필요가 없기 때문에 단지 "),a("code",[t._v("read-only")]),t._v(" 권한만 가져도 충분하다.")]),t._v(" "),a("p",[t._v("이렇게 RBAC은 API 리소스 관리에 대한 액세스를 허용하거나 허용하지 않음으로써 "),a("code",[t._v("사용자")]),t._v(", "),a("code",[t._v("그룹")]),t._v(" 및 "),a("code",[t._v("프로세스")]),t._v("에 대한 정책을 정의한다. 보안에 중점을 둔 클러스터의 경우 RBAC의 규칙을 정하는 것은 아주 중요하다.")]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("RBAC의 목적")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("다양한 역할을 가진 사용자가 쿠버네티스 리소스에 권한을 가지고 접근할 수 있는 시스템 구축")])]),t._v(" "),a("li",[a("p",[t._v("Pod에서 실행되는 프로세스 및 쿠버네티스 API를 통해 수행할 수 있는 작업 제어")])]),t._v(" "),a("li",[a("p",[t._v("네임스페이스 당 특정 리소스의 Visibility 제한")])])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("RBAC의 핵심 요소")])]),t._v(" "),a("img",{staticStyle:{"margin-top":"1rem"},attrs:{src:s(359)}}),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("Subject")])]),t._v(" : 리소스를 사용하려는 사용자\n"),a("ul",[a("li",[t._v("Users, Groups, ServiceAccounts")])])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("API Resources")])]),t._v(" : 쿠버네티스에서 제공하는 개체\n"),a("ul",[a("li",[t._v("Pod, Node, Deployment, ConfigMap, Secret 등")])])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("Operation")])]),t._v(" : 리소스에 대한 동작 (CRUD)\n"),a("ul",[a("li",[t._v("Create, List, Watch, Delete")])])])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("Subject 유형")])]),t._v(" "),a("p",[t._v("RBAC 컨텍스트에서 사용자, 그룹, 서비스계정을 주제로 사용할 수 있다.")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("사용자")]),t._v(" 및 "),a("code",[t._v("그룹")]),t._v("은 쿠버네티스의 데이터베이스인 etcd에 저장되지는 않으며 클러스터 "),a("strong",[t._v("외부")]),t._v("에서 실행되는 프로세스를 위한 것이다.")]),t._v(" "),a("li",[a("code",[t._v("서비스 계정")]),t._v("은 쿠버네티스에서 개체로 존재하며 클러스터 "),a("strong",[t._v("내부")]),t._v("에서 실행되는 프로세스에서 사용된다.")])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("사용자 계정 및 그룹")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("사용자는 관리자에 의해 관리되며 계정의 "),a("strong",[t._v("인증정보(Credential)")]),t._v(" 를 외부 사람이나 프로세스에 배포할 수 있다.")])]),t._v(" "),a("li",[a("p",[t._v("사용자 계정의 경우 API 서버에 대한 호출시 "),a("strong",[t._v("인증")]),t._v("이 필요하다. 쿠버네티스는 이러한 요청에 대해 다양한 인증 방법을 제공한다.")])])]),t._v(" "),a("br"),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("인증 전략")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("설명")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("X.509 client certificate")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("OpenSSL 클라이언트 인증서를 사용하여 인증하기")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Basic Authentication")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("사용자명과 패스워드를 사용하여 인증하기")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Bearer tokens")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Oauth2와 같은 OpenID나 Webhook을 통한 토큰 인증 방식")])])])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("OpenSSL 클라이언트 인증서를 사용하여 인증하기")])]),t._v(" "),a("ul",[a("li",[t._v("사용자 생성을 위해서 관리자 권한이 필요하다.")]),t._v(" "),a("li",[t._v("시험에서는 이미 관련 설정이 되어있어서 사용자를 직접 생성할 필요가 없기 때문에 이 단계를 생략할 수 있다.")])]),t._v(" "),a("ol",[a("li",[t._v("쿠버네티스 ControlPlane 노드에 접속하고 생성된 키를 보관할 임시 디렉토리를 생성하고 이동한다.")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" cert "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" cert\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("a",{attrs:{href:"https://www.openssl.org/source/",target:"_blank",rel:"noopener noreferrer"}},[t._v("openssl"),a("OutboundLink")],1),t._v("을 사용하여 private key를 생성한다.")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ openssl genrsa -out -out ithingv34.key "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\nGenerating RSA private key, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" bit long modulus\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("+\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("+\ne is "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65537")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x10001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nithingv34.key\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Certificate Sign Request(CSR) 생성하기\n"),a("ul",[a("li",[a("code",[t._v("-subj")]),t._v(" 옵션에 "),a("code",[t._v("사용자명(CN)")]),t._v(", "),a("code",[t._v("그룹명(O)")]),t._v("을 붙임")]),t._v(" "),a("li",[t._v("유저를 그룹에 할당하는 것을 막기 위해 "),a("code",[t._v("/O")]),t._v(" 를 남긴다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ openssl req -new -key ithingv34.key -out ithingv34.csr -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=ithingv34/O=cka"')]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nithingv34.csr ithingv34.key\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Kubernetes cluster certificate authority(CA)로 CSR에 서명한다. CA는 보통 "),a("code",[t._v("/etc/kubernetes/pki")]),t._v("에 "),a("code",[t._v("ca.crt")]),t._v(", "),a("code",[t._v("ca.key")]),t._v(" 파일이 저장되어 있다. minikube의 경우 다음처럼 입력하며 인증서는 364일간 유효하다.")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ openssl x509 -req -in ithingv34.csr -CA /.minikube/ca.crt -CAkey "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   /.minikube/ca.key -CAcreateserial -out ithingv34.crt -days "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("364")]),t._v("\nSignature ok\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("subject")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34/O"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cka\nGetting CA Private Key\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[a("code",[t._v("kubeconfig")]),t._v("에서 사용자 항목을 설정하여 쿠버네티스에서 사용자를 만든다.\n"),a("ul",[a("li",[t._v("crt, key 파일을 지정해야한다.")]),t._v(" "),a("li",[t._v("username에 대한 context를 지정해야한다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl config set-credentials ithingv34 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --client-certificate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34.crt --client-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34.key\nUser "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ithingv34"')]),t._v(" set.\n\n$ kubectl config set-context ithingv34-context --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("minikube "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34\nContext "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ithingv34-context"')]),t._v(" modified.\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[t._v("사용자를 변경할 경우에는 "),a("code",[t._v("ithingv34-context")]),t._v("라는 컨텍스트를 사용하면 된다. 현재 사용중인 컨텍스트를 확인할 때는 "),a("code",[t._v("current-context")]),t._v("를 입력한다.")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl config use-context ithingv34-context\nSwitched to context "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ithingv34-context"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n$ kubectl config current-context\nithingv34-context\n")])])]),a("h2",{attrs:{id:"serviceaccount"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serviceaccount"}},[t._v("#")]),t._v(" ServiceAccount")]),t._v(" "),a("p",[t._v("사용자는 "),a("code",[t._v("kubectl")]),t._v(" 이나 UI 대시보드를 사용하여 클러스터와 상호작용할 수 있다. 그런데 Pod와 같은 쿠버네티스 객체 내부에서 실행되는 "),a("a",{attrs:{href:"https://helm.sh/ko/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Helm"),a("OutboundLink")],1),t._v("과 같은 일부 서비스 애플리케이션은 Restful HTTP 호출을 통해 API 서버에 요청을 함으로써 쿠버네티스 클러스와 상호작용한다.")]),t._v(" "),a("p",[t._v("예를들어, Helm chart는 비즈니스 애플리케이션에 필요한 여러 쿠버네티스 객체를 정의한다. 쿠버네티스 "),a("code",[t._v("ServiceAccount")]),t._v(" 를 사용하여 인증 토큰을 통해 API 서버와 함께 Helm 서비스 프로세스를 인증한다. 이 서비스 계정을 Pod에 할당하고 RBAC 규칙에 매핑할 수 있다.")]),t._v(" "),a("p",[t._v("쿠버네티스 클러스터는 따로 지정하지 않는 경우 "),a("code",[t._v("default")]),t._v(" 네임스페이스에 있는 "),a("code",[t._v("ServiceAccount")]),t._v("와 함께 제공된다.")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("ServiceAccount 생성")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl create serviceaccount my-serviceacc\nserviceaccount/serviceacc created\n")])])]),a("div",{staticClass:"language-markdown extra-class"},[a("pre",{pre:!0,attrs:{class:"language-markdown"}},[a("code",[a("span",{pre:!0,attrs:{class:"token title important"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" YAML Manifest")]),t._v("\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n    name: my-serviceacc\n")])])]),a("ul",[a("li",[a("strong",[t._v("ServiceAccount 목록")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl get serviceaccounts\nNAME            SECRETS   AGE\nmy-serviceacc       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("     78s\ndefault             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("     93d\n")])])]),a("ul",[a("li",[a("strong",[t._v("ServiceAccount 세부정보")]),t._v(" "),a("ul",[a("li",[t._v("ServiceAccount를 생성할 때 API 서버가 토큰을 보유하는 Secret을 생헝하고 이를 ServiceAccount에 할당한다.")]),t._v(" "),a("li",[t._v("Secret 및 Token 이름은 ServiceAccount 이름을 접두어로 사용한다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl describe serviceaccount my-serviceacc\nName:                my-serviceacc\nNamespace:           default\nLabels:              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nImage pull secrets:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nMountable secrets:   my-serviceacc-token-rvjnz\nTokens:              my-serviceacc-token-rvjnz\nEvents:              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("ul",[a("li",[a("strong",[t._v("Secret 목록")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl get secrets\nNAME                        TYPE                                    DATA   AGE\nmy-serviceacc-token-rvjnz   kubernetes.io/service-account-token     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("      20m\ndefault-token-qgh5n         kubernetes.io/service-account-token     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("      93d\n\n")])])]),a("ul",[a("li",[a("strong",[t._v("ServiceAccount를 Pod에 할당하기")]),t._v(" "),a("ul",[a("li",[t._v("API를 호출하는 애플리케이션을 실행하는 Pod에 serviceaccount 를 할당할 수 있다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl run my-pod --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alpine --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Never --serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("my-serviceacc\npod/my-pod created\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# YAML Manifest")]),t._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  serviceAccountName: my-serviceacc\n")])])]),a("h2",{attrs:{id:"rbac-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rbac-api"}},[t._v("#")]),t._v(" RBAC API")]),t._v(" "),a("img",{staticStyle:{"margin-top":"1rem"},attrs:{src:s(360)}}),t._v(" "),a("p",[a("strong",[t._v("Role")])]),t._v(" "),a("ul",[a("li",[t._v("Role은 쿠버네티스 리소스에 대한 권한들을 명시해둔 규칙들의 "),a("strong",[t._v("집합")]),t._v("이다.")]),t._v(" "),a("li",[a("code",[t._v("Role")]),t._v("과 "),a("code",[t._v("ClusterRole")]),t._v(" 2가지 종류가 있다.")]),t._v(" "),a("li",[t._v("Role은 그 "),a("strong",[t._v("Role이 속한 네임스페이스 한 곳")]),t._v("에만 적용된다.")]),t._v(" "),a("li",[a("code",[t._v("ClusterRole")]),t._v("은 특정 네임스페이스에 대한 권한이 아닌 "),a("strong",[t._v("클러스터 전체에 대한 권한")]),t._v("을 관리한다.")]),t._v(" "),a("li",[t._v("네임스페이스에 한정되지 않는 자원 및 API들에 대한 권한을 지정할 수도 있다. ex) 특정 노드 혹은 엔드포인트에 대한 권한")])]),t._v(" "),a("p",[a("strong",[t._v("RoleBinding")])]),t._v(" "),a("ul",[a("li",[t._v("RoleBinding은 Role과 사용자를 묶어주는 역할을 한다.")]),t._v(" "),a("li",[t._v("마찬가지로 RoleBinding은 특정 네임스페이스 한 곳에 적용되며 ClusterRoleBinding은 클러스터 전체에 걸쳐 적용된다.")])]),t._v(" "),a("hr"),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("Role 생성하기")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("--verb")]),t._v(" : 가능한 작업을 명시한다.")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("verb")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("의미")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("create")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("새로운 리소스 생성")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("get")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("개별 리소스 조회")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("list")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("여러건의 리소스 조회")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("update")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("기존 리소스내용 전체 업데이트")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("patch")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("기존 리소스중 일부 내용 변경")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("delete")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("개별 리소스 삭제")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("deletecollection")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("여러 리소스 삭제")])])])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("--resource")]),t._v(" :  API 리소스의 목록을 정의한다.")]),t._v(" "),a("li",[t._v("리소스 목록을 제공하지 않으면 모든 리소스 유형에 적용된다.")]),t._v(" "),a("li",[t._v("예시는 "),a("code",[t._v("read-only")]),t._v("라는 역할명을 가지고 pods, deployments, services 리소스에 "),a("code",[t._v("list")]),t._v(", "),a("code",[t._v("get")]),t._v(", "),a("code",[t._v("watch")]),t._v(" 작업이 가능한 역할이다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl create role read-only --verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("list,get,watch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pods,deployments,services\n\nrole.rbac.authorization.k8s.io/read-only created\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# YAML manifest")]),t._v("\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: read-only\nrules:\n- apiGroups:\n  - "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  resources:\n  - pods\n  - services\n  verbs:\n  - list\n  - get\n  - "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v("\n- apiGroups:\n  - apps\n  resources:\n  - deployments\n  verbs:\n  - list\n  - get\n  - "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v("\n\n")])])]),a("ul",[a("li",[a("strong",[t._v("Role 목록")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl get roles\nNAME        CREATED AT\nread-only   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-12-21T19:46:48Z\n")])])]),a("ul",[a("li",[a("strong",[t._v("Role 세부내용")]),t._v(" "),a("ul",[a("li",[t._v("리소스를 허용하는 동사에 매핑하는 테이블을 렌더링한다.")]),t._v(" "),a("li",[t._v("이 클러스터에는 생성된 리소스가 없으므로 리소스 이름 목록이 비어있다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Name:         read-only\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nPolicyRule:\n  Resources         Non-Resource URLs  Resource Names  Verbs\n  ---------         -----------------  --------------  -----\n  pods              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  services          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  deployments.apps  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("hr"),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("RoleBinding 생성")])]),t._v(" "),a("ul",[a("li",[t._v("Role을 RoleBinding에 묶으려면 "),a("code",[t._v("--role")]),t._v(" 옵션을 사용한다.")]),t._v(" "),a("li",[a("code",[t._v("--user")]),t._v(", "),a("code",[t._v("--group")]),t._v(", "),a("code",[t._v("--serviceaccount")]),t._v("에 옵션에 원하는 사용자명을 입력할 수 있다.")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl create rolebinding read-only-binding --role"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("read-only --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34\nrolebinding.rbac.authorization.k8s.io/read-only-binding created\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# YAML Manifest")]),t._v("\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: read-only-binding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: read-only\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: ithingv34\n")])])]),a("ul",[a("li",[a("strong",[t._v("RoleBinding 목록")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl get rolebindings\nNAME                ROLE             AGE\nread-only-binding   Role/read-only   24h\n")])])]),a("ul",[a("li",[a("strong",[t._v("RoleBinding 세부내용")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl describe rolebinding read-only-binding\nName:         read-only-binding\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nRole:\n  Kind:  Role\n  Name:  read-only\nSubjects:\n  Kind  Name     Namespace\n  ----  ----     ---------\n  User  ithingv34\n")])])]),a("ul",[a("li",[a("strong",[t._v("ClusterRole, ClusterRoleBinding 생성")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl create clusterrole read-only-role --verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("list,get,watch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" --resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pods,deployments,services\nclusterrole.rbac.authorization.k8s.io/read-only-role created\n\n\n$ kubectl create clusterrolebinding read-only-role-binding --clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("read-only-role --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ithingv34\nclusterrolebinding.rbac.authorization.k8s.io/read-only-role-binding created\n")])])]),a("hr"),t._v(" "),a("p",[a("strong",[t._v("실제로 RBAC 규칙 적용해보기")])]),t._v(" "),a("ul",[a("li",[t._v("현재 컨텍스트는 "),a("code",[t._v("minikube")])]),t._v(" "),a("li",[t._v("nginx 이미지를 myapp이라는 이름으로 80번 포트에 2개의 replica를 가지는 pod를 배포")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl config current-context\nminikube\n\n$ kubectl create deployment myapp --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\ndeployment.apps/myapp created\n")])])]),a("ol",[a("li",[t._v("유저(ithingv34) 컨텍스트로 전환하기")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl config use-context ithingv34-context\nSwitched to context "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ithingv34-context"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("배포된 deployments 확인하기\n"),a("ul",[a("li",[t._v("유저 ithingv34는 deployment 리소스에 대해 list 작업이 가능한 상태")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl get deployments\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nmyapp   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("           8s\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("유저가 가진 권한들을 확인하는 명령어 ("),a("code",[t._v("auth can-i")]),t._v(")")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ kubectl auth can-i --list --as ithingv34\nResources          Non-Resource URLs   Resource Names   Verbs\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\npods               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nservices           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ndeployments.apps   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("list get watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n$ kubectl auth can-i list pods --as ithingv34\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n")])])]),a("hr")])}),[],!1,null,null,null);e.default=n.exports}}]);